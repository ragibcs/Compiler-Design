# ЁЯУШ Mini Expression Compiler тАФ рж╕ржорзНржкрзВрж░рзНржг ржмрж╛ржВрж▓рж╛ ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи

ржПржЯрж┐ Mini Expression Compiler ржкрзНрж░ржЬрзЗржХрзНржЯрзЗрж░ рж╕ржорзНржкрзВрж░рзНржг ржУ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржмрж╛ржВрж▓рж╛ ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржиред ржПржЦрж╛ржирзЗ ржЖржкржирж┐ ржкрж╛ржмрзЗржитАФ

* ржкрзНрж░ржЬрзЗржХрзНржЯрзЗрж░ рж╕ржорзНржкрзВрж░рзНржг ржмрзНржпрж╛ржЦрзНржпрж╛
* ржкрзНрж░рждрж┐ржЯрж┐ ржлрж╛ржЗрж▓ ржХрзА ржХрж░рзЗ рждрж╛рж░ ржмрзНржпрж╛ржЦрзНржпрж╛
* lexer.l / parser.y / C ржХрзЛржб рж▓рж╛ржЗржи-ржмрж╛ржЗ-рж▓рж╛ржЗржи ржмрзНржпрж╛ржЦрзНржпрж╛
* ржкрзНрж░ржЬрзЗржХрзНржЯрзЗрж░ Errors + рждрж╛ржжрзЗрж░ Fix
* ржЙржирзНржиржд рж╕ржВрж╕рзНржХрж░ржг рждрзИрж░рж┐рж░ ржкрж░рж┐ржХрж▓рзНржкржирж╛

---

# ЁЯзй рзз. ржкрзНрж░ржЬрзЗржХрзНржЯ рж╕рж╛рж░рж╛ржВрж╢ (Overview)

Mini Expression Compiler рж╣рж▓рзЛ ржПржХржЯрж┐ ржЫрзЛржЯ ржХржорзНржкрж╛ржЗрж▓рж╛рж░ ржпрж╛тАФ

1. **Flex** ржжрж┐рзЯрзЗ ржЗржиржкрзБржЯ ржЯрзЛржХрзЗржирзЗ рж░рзВржкрж╛ржирзНрждрж░ ржХрж░рзЗ
2. **Bison** ржжрж┐рзЯрзЗ expression ржкрж╛рж░рзНрж╕ ржХрж░рзЗ
3. **C ржХрзЛржб** ржжрж┐рзЯрзЗ evaluate / compile ржХрж░рзЗ
4. Error рж╣рж▓рзЗ user-friendly ржмрж╛рж░рзНрждрж╛ ржжрзЗржЦрж╛рзЯ

ржПржЗ ржХржорзНржкрж╛ржЗрж▓рж╛рж░ ржорзВрж▓ржд ржЧрж╛ржгрж┐рждрж┐ржХ expression ржирж┐рзЯрзЗ ржХрж╛ржЬ ржХрж░рзЗ ржпрзЗржоржи:

```
3 + 4 * (2 - 1)
```

---

# ЁЯУБ рзи. ржлрзЛрж▓рзНржбрж╛рж░ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░

```
Mini-Expression-Compiler-main/
тФВ
тФЬтФАтФА src/                тЖТ ржорзВрж▓ рж╕рзЛрж░рзНрж╕ ржХрзЛржб
тФЬтФАтФА include/            тЖТ рж╣рзЗржбрж╛рж░ ржлрж╛ржЗрж▓
тФЬтФАтФА samples/            тЖТ ржЙржжрж╛рж╣рж░ржг ржЗржиржкрзБржЯ ржлрж╛ржЗрж▓
тФЬтФАтФА Makefile            тЖТ Linux build
тФЬтФАтФА README.md           тЖТ ржорзВрж▓ ржирж┐рж░рзНржжрзЗрж╢ржирж╛
тФФтФАтФА MiniCompilerGUI.exe тЖТ Windows GUI
```

---

# ЁЯУВ рзй. src/ ржлрзЛрж▓рзНржбрж╛рж░рзЗрж░ ржкрзНрж░рждрж┐ржЯрж┐ ржлрж╛ржЗрж▓рзЗрж░ ржХрж╛ржЬ

## тЬФ lexer.l

Flex рж▓рзЗржХрзНрж╕рж╛рж░ ржлрж╛ржЗрж▓ред ржХрж╛ржЬ:

* ржЗржиржкрзБржЯ рж╕рзНржХрзНржпрж╛ржи ржХрж░рж╛
* ржЯрзЛржХрзЗржи рж░рж┐ржЯрж╛рж░рзНржи ржХрж░рж╛ (NUMBER, PLUS, MINUS, тАж)

## тЬФ parser.y

Bison ржкрж╛рж░рзНрж╕рж╛рж░ ржлрж╛ржЗрж▓ред ржХрж╛ржЬ:

* grammar define ржХрж░рж╛
* expression valid ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рж╛
* parsing tree рждрзИрж░рж┐

## тЬФ codegen.c

Expression evaluate ржмрж╛ code generate ржХрж░рзЗред

## тЬФ error_handler.c

Error ржорзЗрж╕рзЗржЬ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗред

## тЬФ ui.c

ржЯрж╛рж░рзНржорж┐ржирж╛рж▓ UI / CLI interfaceред

## тЬФ main.c

ржкрзБрж░рзЛ ржкрзНрж░рзЛржЧрзНрж░рж╛ржо ржЪрж╛рж▓рж╛рзЯред lexer+parser+ui рж╕ржВржпрзБржХрзНржд ржХрж░рзЗред

---

# ЁЯФН рзк. include/ ржлрзЛрж▓рзНржбрж╛рж░

ржПржЦрж╛ржирзЗ ржкрзНрж░рждрж┐ржЯрж┐ C рж╕рзЛрж░рзНрж╕ ржлрж╛ржЗрж▓рзЗрж░ header ржЖржЫрзЗ:

* codegen.h
* error_handler.h
* ui.h

ржПржЧрзБрж▓рзЛ function declarations рж░рж╛ржЦрзЗред

---

# ЁЯУС рзл. samples/ ржлрж╛ржЗрж▓

### тЬФ test_valid.txt

Valid expression samplesред

### тЬФ test_error.txt

Error рж╣ржУрзЯрж╛ expressionред

### тЬФ test_complex.txt

ржмрзЬ expression test.

---

# ЁЯУШ рзм. lexer.l тАФ рж▓рж╛ржЗржи ржмрж╛ржЗ рж▓рж╛ржЗржи ржмрзНржпрж╛ржЦрзНржпрж╛

(ржкрж░ржмрж░рзНрждрзА ржЖржкржбрзЗржЯрзЗ ржХрзЛржб ржХржкрж┐ ржХрж░рзЗ рж▓рж╛ржЗржи-ржмрж╛ржЗ-рж▓рж╛ржЗржи ржмрзНржпрж╛ржЦрзНржпрж╛ ржпрзЛржЧ ржХрж░рж╛ рж╣ржмрзЗ)

---

# ЁЯУШ рзн. parser.y тАФ рж▓рж╛ржЗржи ржмрж╛ржЗ рж▓рж╛ржЗржи ржмрзНржпрж╛ржЦрзНржпрж╛

(ржкрж░ржмрж░рзНрждрзА ржЖржкржбрзЗржЯрзЗ ржпрзЛржЧ ржХрж░рж╛ рж╣ржмрзЗ)

---

# ЁЯЫа рзо. main.c тАФ рж▓рж╛ржЗржи ржмрж╛ржЗ рж▓рж╛ржЗржи ржмрзНржпрж╛ржЦрзНржпрж╛

(ржкрж░ржмрж░рзНрждрзА ржЖржкржбрзЗржЯрзЗ ржпрзЛржЧ ржХрж░рж╛ рж╣ржмрзЗ)

---

# ЁЯФз рзп. рж╕ржорзНржнрж╛ржмрзНржп Errors ржУ рждрж╛ржжрзЗрж░ Fix

**ржмрж┐рж▓рзНржб рж╕ржорж╕рзНржпрж╛, precedence рж╕ржорж╕рзНржпрж╛, error message рж╕ржорж╕рзНржпрж╛** тАФ ржПржЧрзБрж▓рзЛ ржарж┐ржХ ржХрж░рж╛ рж╣ржмрзЗред

---

# ЁЯЪА рззрзж. ржЙржирзНржиржд рж╕ржВрж╕рзНржХрж░ржг рждрзИрж░рж┐рж░ ржкрж░рж┐ржХрж▓рзНржкржирж╛

* Advanced error messages
* Variable support (x = 5)
* Function support
* Better GUI
* Bytecode / IR output

---

# ЁЯУШ рззрзз. ржкрзНрж░рждрж┐ржЯрж┐ ржлрж╛ржЗрж▓рзЗрж░ рж▓рж╛ржЗржи-ржмрж╛ржЗ-рж▓рж╛ржЗржи ржмрзНржпрж╛ржЦрзНржпрж╛

ржПржЗ рж╕рзЗржХрж╢ржирзЗ ржкрзНрж░ржЬрзЗржХрзНржЯрзЗрж░ рж╕ржм рж╕рзЛрж░рзНрж╕ ржлрж╛ржЗрж▓рзЗрж░ рж╕ржорзНржкрзВрж░рзНржг рж▓рж╛ржЗржи-ржмрж╛ржЗ-рж▓рж╛ржЗржи ржмрзНржпрж╛ржЦрзНржпрж╛ ржпрзБржХрзНржд ржХрж░рж╛ рж╣ржмрзЗ:

## тЬФ lexer.l (Flex Lexer) тАФ рж▓рж╛ржЗржи ржмрж╛ржЗ рж▓рж╛ржЗржи ржмрзНржпрж╛ржЦрзНржпрж╛

ржирж┐ржЪрзЗ `src/lexer.l` ржлрж╛ржЗрж▓рзЗрж░ рж╕ржорзНржкрзВрж░рзНржг ржХрзЛржб ржПржмржВ ржкрзНрж░рждрж┐ржЯрж┐ ржЕржВрж╢рзЗрж░ ржмрзНржпрж╛ржЦрзНржпрж╛ ржжрзЗржУрзЯрж╛ рж╣рж▓рзЛ:

```c
%{
#include "parser.tab.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

extern int yylineno;
%}

%option yylineno

%%

[0-9]+                  { yylval.num = atoi(yytext); return NUMBER; }
[a-zA-Z_][a-zA-Z0-9_]*  { yylval.id = strdup(yytext); return ID; }
"="                     { return ASSIGN; }
"+"                     { return PLUS; }
"-"                     { return MINUS; }
"*"                     { return MUL; }
"/"                     { return DIV; }
"("                     { return LPAREN; }
")"                     { return RPAREN; }
[ 	
]+              { /* ignore whitespace */ }
"//".*                  { /* ignore single-line comments */ }
.                       { return UNKNOWN; }

%%

int yywrap(void) {
    return 1;
}
```

ржПржЦржи рж▓рж╛ржЗржи-ржмрж╛ржЗ-рж▓рж╛ржЗржи ржмрзНржпрж╛ржЦрзНржпрж╛:

### рзз) ржкрзНрж░ржержо ржмрзНрж▓ржХ: `%{ ... %}`

```c
%{
#include "parser.tab.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

extern int yylineno;
%}
```

* `%{` ржПржмржВ `%}` ржПрж░ ржоржзрзНржпрзЗ ржерж╛ржХрж╛ ржЕржВрж╢ржЯрж┐ рж╕рж░рж╛рж╕рж░рж┐ ржЬрзЗржирж╛рж░рзЗржЯ рж╣ржУрзЯрж╛ `lex.yy.c` ржлрж╛ржЗрж▓рзЗ ржХржкрж┐ рж╣рзЯрзЗ ржпрж╛рзЯред ржПржЦрж╛ржирзЗ ржЖржорж░рж╛ ржкрзНрж░рзЯрзЛржЬржирзАрзЯ рж╣рзЗржбрж╛рж░ ржлрж╛ржЗрж▓ржЧрзБрж▓рзЛ ржЗржиржХрзНрж▓рзБржб ржХрж░ржЫрж┐ ржПржмржВ `yylineno` ржбрж┐ржХрзНрж▓рзЗрзЯрж╛рж░ ржХрж░ржЫрж┐ред
* `#include "parser.tab.h"` тЖТ Bison (parser.y) ржерзЗржХрзЗ рждрзИрж░рж┐ рж╣ржУрзЯрж╛ рж╣рзЗржбрж╛рж░ ржлрж╛ржЗрж▓ред ржПржЦрж╛ржирзЗ `NUMBER`, `ID`, `ASSIGN`, `PLUS` ржЗрждрзНржпрж╛ржжрж┐ ржЯрзЛржХрзЗржирзЗрж░ `#define` ржПржмржВ `yylval` ржПрж░ ржбрж┐ржХрзНрж▓рзЗрзЯрж╛рж░рзЗрж╢ржи ржерж╛ржХрзЗред
* `#include <stdio.h>` тЖТ ржЗржиржкрзБржЯ/ржЖржЙржЯржкрзБржЯ ржлрж╛ржВрж╢ржи (ржпрзЗржоржи `printf`) ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржЬржирзНржпред
* `#include <stdlib.h>` тЖТ `atoi` ржЗрждрзНржпрж╛ржжрж┐ ржлрж╛ржВрж╢ржирзЗрж░ ржЬржирзНржпред
* `#include <string.h>` тЖТ `strdup` ржПрж░ ржЬржирзНржп (string ржХржкрж┐ ржХрж░рж╛рж░ ржлрж╛ржВрж╢ржи)ред
* `extern int yylineno;` тЖТ рж▓рж╛ржЗржирзЗрж░ ржирж╛ржорзНржмрж╛рж░ ржЯрзНрж░рзНржпрж╛ржХ ржХрж░рж╛рж░ ржЬржирзНржпред Bison/Flex ржПржХрж╕рж╛ржерзЗ ржХрж╛ржЬ ржХрж░рж╛рж░ рж╕ржорзЯ error message-ржП ржХрзЛржи рж▓рж╛ржЗржирзЗ ржнрзБрж▓ рж╣рзЯрзЗржЫрзЗ рждрж╛ ржжрзЗржЦрж╛рждрзЗ ржХрж╛ржЬрзЗ рж▓рж╛ржЧрзЗред

### рзи) рж▓рзЗржХрзНрж╕ ржЕржкрж╢ржи ржЕржВрж╢

```c
%option yylineno
```

* Flex-ржХрзЗ ржмрж▓рж╛ рж╣ржЪрзНржЫрзЗ ржпрзЗржи рж╕рзЗ ржкрзНрж░рждрж┐ржЯрж┐ ржирждрзБржи рж▓рж╛ржЗржирзЗ `yylineno` ржнрзНржпрж╛рж░рж┐рзЯрзЗржмрж▓ржЯрж┐ ржЖржкржбрзЗржЯ ржХрж░рзЗред ржПрж░ ржлрж▓рзЗ error ржмрж╛ ржбрж┐ржмрж╛ржЧ ржХрж░рж╛рж░ рж╕ржорзЯ рж╕ржарж┐ржХ рж▓рж╛ржЗржи ржиржорзНржмрж░ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯред

### рзй) рж░рзБрж▓ рж╕рзЗржХрж╢ржи рж╢рзБрж░рзБ: `%%`

```c
%%
```

* Flex-ржП ржПржЗ `%%` ржПрж░ ржкрж░ ржерзЗржХрзЗ рж╢рзБрж░рзБ рж╣рзЯ **pattern тЖТ action** рж░рзБрж▓ржЧрзБрж▓рзЛред

### рзк) рж╕ржВржЦрзНржпрж╛ ржЪрж┐ржирждрзЗ ржкрж╛рж░рж╛ рж░рзБрж▓

```c
[0-9]+                  { yylval.num = atoi(yytext); return NUMBER; }
```

* `[0-9]+` тЖТ ржПржХ ржмрж╛ ржПржХрж╛ржзрж┐ржХ digit (рзжтАУрзп)ред ржпрзЗржоржи: `0`, `7`, `123`, `2025` ржЗрждрзНржпрж╛ржжрж┐ред
* `yytext` тЖТ Flex-ржПрж░ ржмрж┐рж▓рзНржЯ-ржЗржи string, ржпрзЗржЦрж╛ржирзЗ current ржорзНржпрж╛ржЪ рж╣ржУрзЯрж╛ ржЯрзЗржХрзНрж╕ржЯ ржерж╛ржХрзЗред
* `atoi(yytext)` тЖТ рж╕рзЗржЗ string-ржХрзЗ integer-ржП convert ржХрж░ржЫрзЗред
* `yylval.num = ...` тЖТ Bison-ржПрж░ `yylval` union ржПрж░ `num` ржлрж┐рж▓рзНржбрзЗ ржПржЗ рж╕ржВржЦрзНржпрж╛ржЯрж┐ рж░рж╛ржЦрж╛ рж╣ржЪрзНржЫрзЗред
* `return NUMBER;` тЖТ parser-ржХрзЗ `NUMBER` ржЯрзЛржХрзЗржи ржкрж╛ржарж╛ржирзЛ рж╣ржЪрзНржЫрзЗред

### рзл) ржЖржЗржбрзЗржирзНржЯрж┐ржлрж╛рзЯрж╛рж░ (ржнрзНржпрж╛рж░рж┐рзЯрзЗржмрж▓ ржирж╛ржо) рж░рзБрж▓

```c
[a-zA-Z_][a-zA-Z0-9_]*  { yylval.id = strdup(yytext); return ID; }
```

* `[a-zA-Z_]` тЖТ ржкрзНрж░ржержо ржХрзНржпрж╛рж░рзЗржХрзНржЯрж╛рж░ ржЕржмрж╢рзНржпржЗ letter ржмрж╛ `_` рж╣ржмрзЗред
* `[a-zA-Z0-9_]*` тЖТ ржкрж░рзЗрж░ ржЕржВрж╢рзЗ рзж ржмрж╛ ржПржХрж╛ржзрж┐ржХ letter/digit/underscore ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗред
* ржПржЗ pattern рж╕рж╛ржзрж╛рж░ржгржд C-style identifier ржПрж░ ржЬржирзНржп ржмрзНржпржмрж╣рж╛рж░ рж╣рзЯ, ржпрзЗржоржи: `x`, `value`, `_temp1` ржЗрждрзНржпрж╛ржжрж┐ред
* `strdup(yytext)` тЖТ `yytext` ржХрзЗ heap-ржП ржирждрзБржи string рж╣рж┐рж╕рзЗржмрзЗ ржХржкрж┐ ржХрж░рзЗред
* `yylval.id = ...` тЖТ Bison-ржПрж░ `yylval` ржПрж░ `id` ржлрж┐рж▓рзНржбрзЗ ржПржЗ string рж░рзЗржЦрзЗ ржжрж┐ржЪрзНржЫрзЗред
* `return ID;` тЖТ parser-ржХрзЗ `ID` ржЯрзЛржХрзЗржи ржкрж╛ржарж╛ржЪрзНржЫрзЗред

### рзм) Assignment ржЕржкрж╛рж░рзЗржЯрж░

```c
"="                     { return ASSIGN; }
```

* `"="` тЖТ ржПржХржжржо exact ржПржЗ ржХрзНржпрж╛рж░рзЗржХрзНржЯрж╛рж░ржЯрж┐ржХрзЗ ржорзНржпрж╛ржЪ ржХрж░ржмрзЗред
* `return ASSIGN;` тЖТ parser-ржХрзЗ `ASSIGN` ржЯрзЛржХрзЗржи ржкрж╛ржарж╛ржмрзЗред рж╕рж╛ржзрж╛рж░ржгржд parser.y-рждрзЗ `ASSIGN` ржмрзНржпржмрж╣рж╛рж░ рж╣рзЯ `ID = expr` ржЯрж╛ржЗржк рж░рзБрж▓рзЗред

### рзн) ржЧрж╛ржгрж┐рждрж┐ржХ ржЕржкрж╛рж░рзЗржЯрж░ржЧрзБрж▓рзЛ

```c
"+"                     { return PLUS; }
"-"                     { return MINUS; }
"*"                     { return MUL; }
"/"                     { return DIV; }
```

* ржкрзНрж░рждрж┐ржЯрж┐ рж▓рж╛ржЗржи ржПржХржЯрж┐ ржХрж░рзЗ ржЕржкрж╛рж░рзЗржЯрж░ ржорзНржпрж╛ржЪ ржХрж░ржЫрзЗ:

  * `"+"` тЖТ `PLUS`
  * `"-"` тЖТ `MINUS`
  * `"*"` тЖТ `MUL`
  * `"/"` тЖТ `DIV`
* ржПржЧрзБрж▓рзЛ parser-ржП ржЧрж╛ржгрж┐рждрж┐ржХ expression parse ржХрж░рж╛рж░ ржЬржирзНржп ржмрзНржпржмрж╣рж╛рж░ рж╣рзЯред

### рзо) ржмрзНрж░рж╛ржХрзЗржЯ/parenthesis

```c
"("                     { return LPAREN; }
")"                     { return RPAREN; }
```

* `"("` тЖТ `LPAREN` (left parenthesis)
* `")"` тЖТ `RPAREN` (right parenthesis)
* ржПржЧрзБрж▓рзЛ expression ржЧрзНрж░рзБржк ржХрж░рж╛рж░ ржЬржирзНржп, ржпрзЗржоржи `(3 + 4) * 2`ред

### рзп) whitespace ржЕржЧрзНрж░рж╛рж╣рзНржп ржХрж░рж╛

```c
[ 	
]+              { /* ignore whitespace */ }
```

* `[ 	
  ]+` тЖТ space, tab (`	`), carriage return (`
  `), newline (`
  `) тАФ ржПржХ ржмрж╛ ржПржХрж╛ржзрж┐ржХ ржмрж╛рж░ред
* action `{ /* ignore whitespace */ }` тЖТ ржХрзЛржирзЛ ржЯрзЛржХрзЗржи рж░рж┐ржЯрж╛рж░рзНржи ржХрж░ржЫрзЗ ржирж╛, ржЕрж░рзНржерж╛рзО parser ржПржЗ whitespace ржжрзЗржЦржмрзЗржЗ ржирж╛ред
* ржПрж░ ржлрж▓рзЗ ржЗржЙржЬрж╛рж░ ржЗржиржкрзБржЯрзЗ line break, spaces ржжрж┐рж▓рзЗржУ expression parsing ржарж┐ржХржЗ ржХрж╛ржЬ ржХрж░ржмрзЗред

### рззрзж) ржПржХ рж▓рж╛ржЗржирзЗрж░ comment рж╣рзНржпрж╛ржирзНржбрж▓ ржХрж░рж╛

```c
"//".*                  { /* ignore single-line comments */ }
```

* `"//"` тЖТ ржкрзНрж░ржержорзЗ `//` ржорзНржпрж╛ржЪ ржХрж░ржмрзЗред
* `.*` тЖТ рждрж╛рж░ржкрж░ рж╕рзЗржЗ рж▓рж╛ржЗржирзЗ ржпржд ржХрж┐ржЫрзБ ржЖржЫрзЗ (ржпрждржХрзНрж╖ржг ржирж╛ newline ржЖрж╕рзЗ) рж╕ржм ржорзНржпрж╛ржЪ ржХрж░ржмрзЗред
* action: comment-ржПрж░ ржЯрзЗржХрзНрж╕ржЯ ignore ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ, parser-ржХрзЗ ржХрж┐ржЫрзБржЗ ржкрж╛ржарж╛ржирзЛ рж╣ржЪрзНржЫрзЗ ржирж╛ред
* C/C++-ржПрж░ single-line comment рж╕рзНржЯрж╛ржЗрж▓ (`// this is comment`) ржХрзЗ рж╕рж╛ржкрзЛрж░рзНржЯ ржХрж░ржЫрзЗред

### рззрзз) ржЕржЬрж╛ржирж╛/ржЕржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд ржХрзНржпрж╛рж░рзЗржХрзНржЯрж╛рж░

```c
.                       { return UNKNOWN; }
```

* `.` тЖТ ржпрзЗржХрзЛржирзЛ single ржХрзНржпрж╛рж░рзЗржХрзНржЯрж╛рж░ ржпрж╛ ржПрж░ ржЖржЧрзЗрж░ ржХрзЛржирзЛ рж░рзБрж▓рзЗ ржорзНржпрж╛ржЪ рж╣рзЯржирж┐ред
* `return UNKNOWN;` тЖТ parser-ржХрзЗ `UNKNOWN` ржЯрзЛржХрзЗржи ржкрж╛ржарж╛ржирзЛ рж╣ржЪрзНржЫрзЗред
* parser.y-рждрзЗ рж╕рж╛ржзрж╛рж░ржгржд `UNKNOWN` ржЯрзЛржХрзЗржи ржжрж┐рзЯрзЗ error рж╣рзНржпрж╛ржирзНржбрж▓ ржХрж░рж╛ ржпрж╛рзЯ (ржпрзЗржоржи syntax error)ред

### рззрзи) ржжрзНржмрж┐рждрзАрзЯ `%%` тАФ ржХрзЛржб рж╕рзЗржХрж╢ржи рж╢рзБрж░рзБ

```c
%%

int yywrap(void) {
    return 1;
}
```

* ржжрзНржмрж┐рждрзАрзЯ `%%` ржПрж░ ржкрж░ ржерзЗржХрзЗ C ржХрзЛржб рж▓рзЗржЦрж╛ рж╣рзЯ ржпрж╛ `lex.yy.c` ржПрж░ рж╢рзЗрж╖рзЗ ржпрзБржХрзНржд рж╣рзЯред
* `int yywrap(void)` тЖТ Flex-ржПрж░ requirement ржЕржирзБржпрж╛рзЯрзА ржпржЦржи ржЖрж░ ржЗржиржкрзБржЯ ржерж╛ржХрзЗ ржирж╛ рждржЦржи `yywrap()` ржХрж▓ рж╣рзЯред
* `return 1;` тЖТ ржмрж▓рзЗ ржжрж┐ржЪрзНржЫрзЗ ржпрзЗ ржЖрж░ ржХрзЛржирзЛ ржЗржиржкрзБржЯ ржирзЗржЗ, рж╕рзНржХрзНржпрж╛ржирж┐ржВ рж╢рзЗрж╖ред

### рззрзй) ржПржЦрж╛ржирзЗ ржпрзЗржЯрж╛ Error ржЫрж┐рж▓ ржПржмржВ ржарж┐ржХ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ

ржЖржкржирж╛рж░ ржжрзЗржУрзЯрж╛ ржЖрж╕рж▓ `lexer.l` ржлрж╛ржЗрж▓рзЗ ржПржХржЯрж┐ рж▓рж╛ржЗржи ржЫрж┐рж▓:

```c
...
```

* Flex-ржП `...` ржХрзЛржирзЛ ржмрзИржз pattern ржирж╛ (ржПржнрж╛ржмрзЗ ржПржХрж╛ `...` ржжрж┐рж▓рзЗ ржХржорзНржкрж╛ржЗрж▓ Error рж╣ржмрзЗ)ред
* рждрж╛ржЗ ржЖржорж░рж╛ **ржПржЯрж╛ржХрзЗ ржкрзБрж░рзЛржкрзБрж░рж┐ ржорзБржЫрзЗ ржжрж┐рзЯрзЗржЫрж┐**, ржПржмржВ ржЯрзЛржХрзЗржи рж▓рж┐рж╕рзНржЯржХрзЗ рж╕ржарж┐ржХржнрж╛ржмрзЗ рж╕рж╛ржЬрж┐рзЯрзЗржЫрж┐ред
* ржарж┐ржХ ржХрж░рж╛ ржнрж╛рж░рзНрж╕ржи ржЙржкрж░рзЗ ржХрзЛржб ржмрзНрж▓ржХрзЗ ржжрзЗржУрзЯрж╛ рж╣рзЯрзЗржЫрзЗ тАФ ржПржЯрж┐ржЗ ржХржорзНржкрж╛ржЗрж▓/рж░рж╛ржи ржХрж░рж╛рж░ ржЬржирзНржп ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржиред

---

## тЬФ parser.y (Bison Parser) тАФ рж▓рж╛ржЗржи ржмрж╛ржЗ рж▓рж╛ржЗржи ржмрзНржпрж╛ржЦрзНржпрж╛

ржирж┐ржЪрзЗ `src/parser.y` ржлрж╛ржЗрж▓рзЗрж░ ржорзВрж▓ ржХрж╛ржарж╛ржорзЛ ржПржмржВ ржкрзНрж░рждрж┐ржЯрж┐ рж╕рзЗржХрж╢ржирзЗрж░ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржмрзНржпрж╛ржЦрзНржпрж╛ ржпрзБржХрзНржд ржХрж░рж╛ рж╣рж▓рзЛ:

### ЁЯФ╣ рзз) ржкрзНрж░рзЛрж▓ржЧ рж╕рзЗржХрж╢ржи: `%{ ... %}`

ржПржЦрж╛ржирзЗ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ рж╣рзЗржбрж╛рж░ ржлрж╛ржЗрж▓ include ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ ржПржмржВ Bison ржУ Flex ржПрж░ ржоржзрзНржпрзЗ ржпрзЛржЧрж╛ржпрзЛржЧрзЗрж░ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ ржУ ржлрж╛ржВрж╢ржи ржШрзЛрж╖ржгрж╛ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ:

* `#include "codegen.h"` тЖТ ржХрзЛржб ржЬрзЗржирж╛рж░рзЗрж╢ржи ржлрж╛ржВрж╢ржи
* `#include "error_handler.h"` тЖТ error message рждрзИрж░рж┐
* `extern int yylex();` тЖТ Flex scanner
* `extern int yylineno;` тЖТ рж▓рж╛ржЗржи ржиржорзНржмрж░
* `extern char* yytext;` тЖТ ржмрж░рзНрждржорж╛ржи ржЯрзЛржХрзЗржи ржЯрзЗржХрзНрж╕ржЯ
* `void yyerror(const char *s);` тЖТ syntax error callback
* `int temp_var_count = 0;` тЖТ ржЯрзЗржорзНржкрзЛрж░рж╛рж░рж┐ ржнрзНржпрж╛рж░рж┐рзЯрзЗржмрж▓рзЗрж░ ржХрж╛ржЙржирзНржЯрж╛рж░

### ЁЯФ╣ рзи) `%union`

Parser ржПрж░ semantic ржорж╛ржи рж░рж╛ржЦрждрзЗ ржмрзНржпржмрж╣рзГржд data types:

* `int num;` тЖТ NUMBER ржПрж░ ржорж╛ржи
* `char* id;` тЖТ Identifier рж╕рзНржЯрзНрж░рж┐ржВ
* `char* temp;` тЖТ Temp variable ржирж╛ржо (codegen ржП ржмрзНржпржмрж╣рзГржд)

### ЁЯФ╣ рзй) Token declaration

* `%token <num> NUMBER` тЖТ рж╕ржВржЦрзНржпрж╛рж░ ржЯрзЛржХрзЗржи
* `%token <id> ID` тЖТ ржнрзНржпрж╛рж░рж┐ржпрж╝рзЗржмрж▓ ржирж╛ржо
* ржЕржирзНржпрж╛ржирзНржп: ASSIGN, SEMICOLON, PLUS, MINUS, MUL, DIV, LPAREN, RPAREN, UNKNOWN

### ЁЯФ╣ рзк) Non-terminal ржПрж░ semantic ржЯрж╛ржЗржк ржбрж┐ржлрж╛ржЗржи ржХрж░рж╛

* `%type <temp> expression term factor`

### ЁЯФ╣ рзл) Operator precedence ржирж┐рж░рзНржзрж╛рж░ржг

* `%left PLUS MINUS`
* `%left MUL DIV` тЖТ ржПржЗ ржХрж╛рж░ржгрзЗ `*` ржУ `/` ржЖржЧрзЗ evaluate рж╣ржпрж╝

---

## Grammar Rules ржмрзНржпрж╛ржЦрзНржпрж╛

### тЬФ `program`

```
program:
    /* empty */
    | program statement
;
```

* ржПржХржЯрж┐ ржкрзНрж░рзЛржЧрзНрж░рж╛ржо ржЕржирзЗржХржЧрзБрж▓рзЛ `statement` ржПрж░ рж╕ржоржирзНржмрзЯрзЗ ржЧржарж┐ржд

### тЬФ `statement`

Assignment / Expression / Error handling

* `ID = expression;` тЖТ assignment
* `expression;` тЖТ рж╢рзБржзрзБ evaluate
* syntax error рж╣рж▓рзЗ рж╕рзБржирзНржжрж░ error message
* `yyerrok;` тЖТ parser error recovery

### тЬФ `expression`

PLUS / MINUS numeric operation ржЙрзОржкржирзНржи ржХрж░рзЗ:

* ржкрзНрж░рждрж┐ржЯрж┐ ржЕржкрж╛рж░рзЗрж╢ржирзЗрж░ ржЬржирзНржп ржирждрзБржи temp var рждрзИрж░рж┐
* Codegen ржлрж╛ржВрж╢ржи call ржХрж░рзЗ instruction рждрзИрж░рж┐

### тЬФ `term`

MUL / DIV handle ржХрж░рзЗ

### тЬФ `factor`

рж╕ржорзНржнрж╛ржмрзНржп ржЗржиржкрзБржЯ:

* NUMBER тЖТ string-ржП ржХржиржнрж╛рж░рзНржЯ
* ID тЖТ рж╕рж░рж╛рж╕рж░рж┐ return
* `(expression)` тЖТ ржнрзЗрждрж░рзЗрж░ ржорж╛ржи ржмрзНржпржмрж╣рж╛рж░
* Parenthesis error тЖТ suggestive error message
* UNKNOWN тЖТ invalid ржЯрзЛржХрзЗржи

ржкрзНрж░рждрж┐ржЯрж┐ рж░рзБрж▓ рж╢рзЗрж╖рзЗ memory leak рж░рзЛржзрзЗ `free()` ржмрзНржпржмрж╣рж╛рж░

---

### тЬФ Error Handling

Parser ржП `yyerror()` override ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ ржпрж╛рждрзЗ рж╕ржм error `error_handler.c` ржжрж┐рзЯрзЗ рж╣рзНржпрж╛ржирзНржбрж▓ рж╣ржпрж╝

```c
void yyerror(const char *s) {
    // Error handling is done in error_handler.c
}
```

ржПрждрзЗ syntax error message рж╕рзБржирзНржжрж░ржнрж╛ржмрзЗ show ржХрж░рж╛ ржпрж╛ржпрж╝

---

## рж╕рж╛рж░рж╛ржВрж╢

`parser.y` рж╕ржорзНржкрзВрж░рзНржг expression grammar define ржХрж░рзЗ ржПржмржВ codegen.c ржХрзЗ ржХрж▓ ржХрж░рзЗ
temp variable ржПрж░ ржорж╛ржзрзНржпржорзЗ intermediate code build ржХрж░рзЗ

---

## тЬФ main.c тАФ рж▓рж╛ржЗржи ржмрж╛ржЗ рж▓рж╛ржЗржи ржмрзНржпрж╛ржЦрзНржпрж╛

(ржПржЦрж╛ржирзЗ main.c ржлрж╛ржЗрж▓рзЗрж░ ржмрзНржпрж╛ржЦрзНржпрж╛ ржпрзЛржЧ ржХрж░рж╛ рж╣ржмрзЗ)
.c тАФ рж▓рж╛ржЗржи
